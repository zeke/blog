<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="author" content="Max Ogden" />
    <title>Bringing Minecraft to the Open Web</title>
  </head>
  
  <body>
    <div id="header">
      
      <h1 class="title">Bringing a Minecraft-style engine to the Open Web</h1>
      
      <h2 class="author">Max Ogden</h2>

    </div>  
      <p>Shortly after Christmas 2012 (about 3 and a half weeks ago) the <a href="http://www.2playerproductions.com/projects/minecraft">Story of Mojang</a> was <a href="http://www.gameinformer.com/b/news/archive/2012/12/22/minecraft-the-story-of-mojang-documentary-creators-torrent-their-own-film.aspx">intentionally released</a> as a torrent. I was inspired. A year earlier I had purchased 2 copies of Minecraft for my nephews to play (and they haven't done much else since) but as gaming hasn't been a big part of my life for the last few years (because I've been too busy programming) I never had much time to play the game. Seeing how engaging Minecraft could be for my nephews was fascinating so I started looking into the modding community to see how feasible it would be to do things like hook Minecraft up to <a href="http://en.wikipedia.org/wiki/OpenStreetMap">OpenStreetMap</a>. My first foray into programming logic was <a href="http://maxogden.com/little-coders.html">in Starcraft</a> over a decade ago so I figured that a game that is so addicting and yet so simple could be a really powerful platform for education.
      </p>
      <p>
        I was disappointed to find out that not only is Minecraft closed-source but it also hasn't shipped an official API (these are used to extend a programs functionality). Instead, if you want to change the way Minecraft works, you have to decompile the Java program that Mojang distributes and then reverse engineer it to make it do what you want. Despite these technical hurdles, due to the success of Minecraft there is still a huge modding community. One of my favorites is <a href="http://wiki.sk89q.com/wiki/WorldEdit">World Edit</a>, which lets you bulk edit the Minecraft world by doing things like making giant pyramids, spheres, rectangles or even <a href="http://www.youtube.com/watch?v=PmyBs4IXFdM">frosted donuts</a>. 
      </p>
      <p>
        The first thing I tried to do was install a plugin. I immediately found myself on old forum posts that I found on google while looking for answers to obscure questions like what the OS X path is for the plugin folder, how to downgrade my Minecraft version because I had upgraded to the newest version which broke the plugin I was trying to use and how to edit a Minecraft world file that I had downloaded from someone else to change the game mode from Survival to Creative (turns out you have to use a hex editor).
      </p>
      <p>For the last couple years I have grown accustomed to the automated installation of modules that <a href="http://npmjs.org">NPM</a> provides and wondered if anyone had tried to make a package manager for Minecraft plugins. There are a few out there, but quite frankly they all reeked of Java and were limited by the nature of decompiling as a workaround to Minecrafts lack of an API. 
      </p>
      <h1>Has anyone written a voxel engine in JS?</h1>
      <p>At this point I had decided that decompiling Java wasn't in my future, so as any JavaScript programmer would do I decided to rewrite the entire thing in JavaScript. The fun part is that at the time (3.5 weeks ago) I had zero experience programming games. But I had google search and free time. 
      </p>
      <p>On Github I <a href="https://gist.github.com/4637750">found 26 repositories</a> that contained some approach to rendering voxels in a browser. I spent a few days getting them to run on my computer and reading the source code of every single one. The projects that stood out were <a href="https://github.com/mitsuhiko/webgl-meincraft">webgl-meincraft</a>, <a href="https://github.com/jwagner/voxelworlds">voxelworlds</a> and <a href="https://github.com/danielribeiro/WebGLCraft">WebGLCraft</a>. Daniel Ribeiro wrote a post one year ago called <a href="http://metaphysicaldeveloper.wordpress.com/2011/12/20/implementing-minecraft-in-webgl/">Implementing Minecraft in WebGL</a> and Jonas Wagner did a talk at <a href="http://ongamestart.com/">OnGameStart</a> a few months ago called <a href="http://29a.ch/2012/12/9/webgl-voxel-worlds">Rendering Voxel Worlds using WebGL</a> and produced <a href="http://29a.ch/sandbox/2012/voxelworld/">this impressive demo</a>. I later found <a href="https://github.com/benvanik/blk-game">BLK Game</a> by Ben Vanik from Google which also has an <a href="http://benvanik.github.com/blk-game/">impressive demo</a>. My problem with every single one of the 26 projects that I found is that they were all huge projects that were hard to wrap your head around and hack on. I was trying to escape the Java mentality and make game development small and modular (like NPM) but didn't find a single project that had well documented, modular components. Some were written in coffeescript, hadn't been updated in over a year, had giant lib/ folders filled with custom written modules or only produced a single tech demo and then were never used again. 
      </p>
      <p>
        I also discovered an obscure subreddit called <a href="http://www.reddit.com/r/voxelgamedev">voxelgamedev</a> that had produced a wiki page called <a href="http://www.reddit.com/r/gamedev/wiki/block_engines">The BIG list of block engines and resources!</a>. Through this I found out about Mikola Lysenko's blog <a href="http://0fps.wordpress.com">0fps.wordpress.com</a> and his articles <a href="http://0fps.wordpress.com/2012/06/30/meshing-in-a-minecraft-game/">Meshing in a Minecraft Game</a>, <a href="http://0fps.wordpress.com/2012/07/07/meshing-minecraft-part-2/">Meshing in a Minecraft Game (Part 2)</a> and <a href="http://0fps.wordpress.com/2012/01/14/an-analysis-of-minecraft-like-engines/">An Analysis of Minecraft-like Engines</a>. Not only were these written in an amazingly accessible way but they also had a <a href="http://mikolalysenko.github.com/MinecraftMeshes2/">voxel meshing sandbox</a> implemented in WebGL and <a href="http://mrdoob.github.com/three.js/">three.js</a>.
      </p>
      <h1>Start with a few small modules</h1>
      <p>Mikola had some code <a href="https://github.com/mikolalysenko/mikolalysenko.github.com/tree/master/MinecraftMeshes2/js">hidden away</a> in his blog that I used a the basis for two modules: <a href="https://npmjs.org/package/voxel">voxel</a> and <a href="https://npmjs.org/package/voxel-mesh">voxel-mesh</a>. With these two modules I could create a little wireframe world.
      </p>
      <p>
        <img src="/media/wireframe-hill.png">
      </p>
      <p>You should read Mikola's posts but the main idea with a voxel rendering engine is to create chunks of voxels. If you try to treat each individual voxel as an individual cube then you will have to send too much state back and forth to the GPU and your game will be slow. If you use one giant mesh for all the voxels in your world then it will take to long when a player digs a hole in the ground because you will have to recalculate the entire world. Chunks should be sized "just-right" in the middle of these two extremes so that you aren't making thousands of draw calls per frame but also can make voxel editing imperceptibly fast.</p>
      <p>
        <img src="/media/wireframe-edit.gif">
      </p>
  </body>

</html>