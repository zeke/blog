<!DOCTYPE html> 
<html> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/rss+xml" title="Max Ogden Blogotronz (RSS 2.0)" href="http://maxogden.com/rss.xml">
  <title>Max Ogden Blogotronz</title> 
  
  <link href="styles/styles.css" media="screen" rel="stylesheet" type="text/css">
  <link href="styles/rainbow.github.css" media="screen" rel="stylesheet" type="text/css">

  <!-- libraries --> 
  <script src="script/jquery-1.6.1.min.js"></script>
  <script src="script/underscore.js"></script>
  <script src="script/d3.min.js"></script>
  <script src="script/voronoi.min.js"></script>
  <script src="script/rainbow.min.js"></script>
  <script src="script/rainbow.generic.js"></script>
  <script src="script/rainbow.javascript.js"></script>
  <script src="script/rainbow.css.js"></script>
  <script src="script/helpers.js"></script>
  
  <script src="script/application.js"></script>

</head>
<body> 
  <div id="container">
    <div class="header">
      <div class="title">Max Ogden | <a href="http://tantek.com/2010/281/b1/what-is-the-open-web">Open Web</a> developer</div>
      <div class="subtitle"></div>
      <!-- THANKS, MICHAEL BOSTOCK! YOU RULE -->
      <div id="voronoi">
      </div>
      <div class="channel"></div>
      <div id="navigation">
        <div class="toggle home">
          <div class="navitem">
            <a href="index.html">blog</a>
          </div>
        </div>
        <div class="toggle home">
          <div class="navitem">
            <a href="projects.html">projects</a>
          </div>
        </div>
        <div class="toggle home">
          <div class="navitem">
            <a href="videos.html">media</a>
          </div>
        </div>
        <div class="toggle home">
          <div class="navitem">
            <a href="contact.html">contact</a>
          </div>
        </div>
      </div>
    </div>
    
    <div id="wrapper">
      <div id="browser">
        <div id="documents"><a class="load-document" href="node-packaged-modules.html">
  <div class="document" id="node-packaged-modules">
    <div class="published" data-published="2013-07-08T20:48:11.493Z">July 2013</div>
    <div class="title">Node Packaged Modules</div>
    <div class="teaser">Bringing NPM modules to the web</div>
  </div>
</a>

<a class="load-document" href="kindleberry-wireless.html">
  <div class="document" id="kindleberry-wireless">
    <div class="published" data-published="2013-03-24T20:48:11.493Z">March 2013</div>
    <div class="title">Kindleberry Wireless</div>
    <div class="teaser">A Portable Outdoor Hackstation</div>
  </div>
</a>

<a class="load-document" href="bringing-minecraft-style-games-to-the-open-web.html">
  <div class="document" id="bringing-minecraft-style-games-to-the-open-web">
    <div class="published" data-published="2013-01-25T20:48:11.493Z">January 2013</div>
    <div class="title">Bringing Minecraft-style games to the Open Web</div>
    <div class="teaser">A status report from the one month old voxel.js project</div>
  </div>
</a>

<a class="load-document" href="a-proposal-for-streaming-xhr.html">
  <div class="document" id="a-proposal-for-streaming-xhr">
    <div class="published" data-published="2012-11-20T20:48:11.493Z">November 2012</div>
    <div class="title">A Proposal For Streaming XHR</div>
    <div class="teaser">XHR2 isn't stream friendly. Lets explore why and propose a solution!</div>
  </div>
</a>

<a class="load-document" href="scraping-with-node.html">
  <div class="document active" id="scraping-with-node">
    <div class="published" data-published="2012-10-24T20:48:11.493Z">October 2012</div>
    <div class="title">Scraping With Node</div>
    <div class="teaser">Useful modules and a tutorial on how to parse HTML with node.js</div>
  </div>
</a>

<a class="load-document" href="building-webview-applications.html">
  <div class="document" id="building-webview-applications">
    <div class="published" data-published="2012-10-15T20:48:11.493Z">October 2012</div>
    <div class="title">Building WebView Applications</div>
    <div class="teaser">Things I learned while building @gather</div>
  </div>
</a>

<a class="load-document" href="fast-webview-applications.html">
  <div class="document" id="fast-webview-applications">
    <div class="published" data-published="2012-05-31T20:48:11.493Z">May 2012</div>
    <div class="title">Fast WebView Applications</div>
    <div class="teaser">How to make web apps feel fast and responsive</div>
  </div>
</a>

<a class="load-document" href="node-streams.html">
  <div class="document" id="node-streams">
    <div class="published" data-published="2012-04-17T23:52:20.241Z">April 2012</div>
    <div class="title">Node Streams: How do they work?</div>
    <div class="teaser">Description of and notes on the node.js Stream API</div>
  </div>
</a>

<a class="load-document" href="replicating-large-datasets-into-html5.html">
  <div class="document" id="replicating-large-datasets-into-html5">
    <div class="published" data-published="2012-04-14T06:32:16.787Z">April 2012</div>
    <div class="title">Replicating large datasets into HTML5</div>
    <div class="teaser">Typed arrays, streaming json and IndexedDB!</div>
  </div>
</a>

<a class="load-document" href="open211.html">
  <div class="document" id="open211">
    <div class="published" data-published="2012-01-30T01:57:20.310Z">January 2012</div>
    <div class="title">Open211</div>
    <div class="teaser">An open source directory of social programs and services</div>
  </div>
</a>

<a class="load-document" href="gut-hosted-open-data-filets.html">
  <div class="document" id="gut-hosted-open-data-filets">
    <div class="published" data-published="2011-12-02T20:36:31.424Z">December 2011</div>
    <div class="title">Gut: Hosted Open Data Filet Knives</div>
    <div class="teaser">HTTP Unix pipes for Open Data</div>
  </div>
</a>

<a class="load-document" href="mobile-crowdsourcing-interfaces.html">
  <div class="document" id="mobile-crowdsourcing-interfaces">
    <div class="published" data-published="2011-07-30T17:20:49.949Z">July 2011</div>
    <div class="title">Mobile Crowdsourcing Interfaces</div>
    <div class="teaser">Some experiments in collecting images + location from mobile devices</div>
  </div>
</a>

<a class="load-document" href="little-coders.html">
  <div class="document" id="little-coders">
    <div class="published" data-published="2011-07-17T02:56:48.555Z">July 2011</div>
    <div class="title">Little Coders</div>
    <div class="teaser">Elementary school programming</div>
  </div>
</a></div>
      </div>
      <div id="document"><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <meta name="generator" content="pandoc">
    <meta name="author" content="Max Ogden">
    <title>Scraping with Node</title>
  </head>
  
  <body>
    <div id="header">
      <h1 class="title">Scraping with Node</h1>
      <h2 class="author">Max Ogden</h2>
    </div>
    <p>Modules and tutorial demonstrating HTML parsing with node.js</p>
    <p>One of the the best parts about server side JavaScript is the lack of the DOM, but sometimes you need to parse HTML in your node programs. For a while JSDOM has been the most well known module for accomplishing this task, but it has a number of issues. The author, <a href="http://twitter.com/tmpvar">@tmpvar</a>, has been developing <a href="http://www.flickr.com/photos/gasi/7534134630/in/photostream/">super awesome node powered robots</a> instead of maintaining it. It also turns out that a full DOM level 3 implementation is super complex and crazy which means JSDOM suffers from some pretty bad memory leaks that leaves it unusable for a lot of complex use cases.</p>
    <p>Instead of rewriting the DOM in pure JS, a more realistic approach is a nice and simple HTML parser that implements a CSS selector API. Enter <a href="http://npmjs.org/cheerio"><code>cheerio</code></a>, a module that can teach your server HTML.</p>
    <p>Cheerio is built on top of the <a href="http://npmjs.org/htmlparser2"><code>htmlparser2</code></a> module, a sax-like parser for HTML/XML. The goal of Cheerio is to implement most of the jQuery API in pure JS, without the need for a DOM. There is a separate dependency called <a href="https://npmjs.org/package/cheerio-select"><code>cheerio-select</code></a> that implements the sizzle API. The <code>cheerio</code> module itself more or less implements the jQuery API.</p>
    <h2>Using Cheerio</h2>
    <p>Since there is no DOM in node you have to initialize a <code>cheerio</code> instance from an HTML string. (this example comes from the <a href="http://npmjs.org/cheerio#readme">cheerio readme</a>)</p>
    
<pre><code data-language="javascript">var cheerio = require(&#39;cheerio&#39;),
    $ = cheerio.load(&#39;&lt;h2 class = &quot;title&quot;&gt;Hello world&lt;/h2&gt;&#39;);

$(&#39;h2.title&#39;).text(&#39;Hello there!&#39;);
$(&#39;h2&#39;).addClass(&#39;welcome&#39;);

$.html();
//=&gt; &lt;h2 class = &quot;title welcome&quot;&gt;Hello there!&lt;/h2&gt;
</code></pre>
<p>If you have an HTML file on disk that you want to load, you can use nodes <code>fs</code> module (warning: don't use sync calls inside an event loop, only use them when you don't care about performance):</p>

<pre><code data-language="javascript">var $ = require('cheerio')
var fs = require('fs')

var htmlString = fs.readFileSync('index.html').toString()
var parsedHTML = $.load(htmlString)

// query for all elements with class 'foo' and loop over them
parsedHTML('.foo').map(function(i, foo) {
  // the foo html element into a cheerio object (same pattern as jQuery)
  foo = $(foo)
  console.log(foo.text())
})
</code></pre>

<p>Similarly, you can use the popular <a href="http://npmjs.org/request">request</a> module to grab HTML from a remote server using HTTP and then pass it to <code>cheerio</code>:</p>

<pre><code data-language="javascript">var $ = require('cheerio')
var request = require('request')

function gotHTML(err, resp, html) {
  if (err) return console.error(err)
  var parsedHTML = $.load(html)
  // get all img tags and loop over them
  var imageURLs = []
  parsedHTML('a').map(function(i, link) {
    var href = $(link).attr('href')
    if (!href.match('.png')) return
    imageURLs.push(domain + href)
  })
}

var domain = 'http://substack.net/images/'
request(domain, gotHTML)
</code></pre>

<p>Building on the last example, here is how to fetch the raw binary data of each <code>img</code> on the page and render the images in your terminal using <a href="http://npmjs.org/picture-tube">picture-tube</a> and the node <a href="https://github.com/substack/stream-handbook">Stream API</a>:</p>

<pre><code data-language="javascript">var pictureTube = require('picture-tube')

var randomIndex = Math.floor(Math.random() * imageURLs.length)
var randomImage = imageURLs[randomIndex]
request(randomImage).pipe(pictureTube()).pipe(process.stdout)
</code></pre>

<p><img src="/media/picture-tube.png"></p>

<p>Now, go forth and scrape!</p>
</body>

</html></div>
    </div>
  </div>  
  
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24933665-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body> 
</html>
